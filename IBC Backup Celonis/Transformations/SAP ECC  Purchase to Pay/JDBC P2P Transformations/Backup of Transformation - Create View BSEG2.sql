
DROP VIEW IF EXISTS BSEG_S;
CREATE VIEW BSEG_S AS (

Select * FROM (
Select 
"B"."MANDT"
,"B"."BUKRS"
,"B"."BELNR"
,"B"."GJAHR"
,"B"."BUZEI"
,"B"."BUZID"
,"B"."AUGDT"
,"B"."BSCHL"
,"B"."KOART"
,"B"."WRBTR"
,"B"."SAKNR"
,"B"."HKONT"
,"B"."KUNNR"
,"B"."LIFNR"
,"B"."ZUONR" -- ergänzt Chris
,"B"."FLAG"
,ROW_NUMBER() OVER (partition by BELNR order by BUZEI) AS ROWNUMBER
FROM(
Select 
"B"."MANDT"
,"B"."BUKRS"
,"B"."BELNR"
,"B"."GJAHR"
,"B"."BUZEI"
,"B"."BUZID"
,"B"."AUGDT"
,"B"."BSCHL"
,"B"."KOART"
,"B"."WRBTR"
,"B"."SAKNR"
,"B"."HKONT"
,"B"."KUNNR"
,"B"."LIFNR"
,"B"."ZUONR" -- ergänzt Chris 
,CASE WHEN B.HKONT IN (
'0000002500'
,'0000005300'
,'0000005400'
,'0000005500'
,'0000005600'
,'0000005700'
,'0000007000'
,'0000007100'
,'0000007200'
,'0000008000'
,'0000008100'
,'0000008200'
,'0000009100'
,'0000020000'
,'0000020050'
,'0000020100'
,'0000021000'
,'0000021100'
,'0000022000'
,'0000022100'
,'0000022102'
,'0000060000'
,'0000060001'
,'0000060002'
,'0000060003'
,'0000060004'
,'0000060010'
,'0000060020'
,'0000060030'
,'0000060040'
,'0000060100'
,'0000060110'
,'0000060200'
,'0000060210'
,'0000060220'
,'0000060225'
,'0000060230'
,'0000060235'
,'0000060240'
,'0000060250'
,'0000060260'
,'0000060270'
,'0000060280'
,'0000060290'
,'0000060295'
,'0000060300'
,'0000060310'
,'0000060320'
,'0000060330'
,'0000060340'
,'0000060350'
,'0000060360'
,'0000060400'
,'0000060500'
,'0000060505'
,'0000060510'
,'0000060520'
,'0000060525'
,'0000060530'
,'0000060540'
,'0000060550'
,'0000060560'
,'0000060570'
,'0000060590'
,'0000060591'
,'0000060600'
,'0000060700'
,'0000060800'
,'0000060802'
,'0000060900'
,'0000060905'
,'0000060910'
,'0000060911'
,'0000060920'
,'0000060921'
,'0000060930'
,'0000060990'
,'0000061000'
,'0000061100'
,'0000061201'
,'0000061202'
,'0000061203'
,'0000061204'
,'0000061205'
,'0000061300'
,'0000061310'
,'0000061400'
,'0000061410'
,'0000061420'
,'0000061430'
,'0000061490'
,'0000061491'
,'0000067200'
,'0000067210'
,'0000067220'
,'0000067230'
,'0000067630'
,'0000068000'
,'0000068010'
,'0000068300'
,'0000068310'
,'0000069900'
) THEN 'X' ELSE NULL END AS "FLAG"
FROM BSEG 
INNER JOIN BSEG2 AS B ON 1=1 
AND BSEG.BELNR = B.BELNR 
WHERE B.BUZEI > '001' AND B.HKONT IN (
'0000002500'
,'0000005300'
,'0000005400'
,'0000005500'
,'0000005600'
,'0000005700'
,'0000007000'
,'0000007100'
,'0000007200'
,'0000008000'
,'0000008100'
,'0000008200'
,'0000009100'
,'0000020000'
,'0000020050'
,'0000020100'
,'0000021000'
,'0000021100'
,'0000022000'
,'0000022100'
,'0000022102'
,'0000060000'
,'0000060001'
,'0000060002'
,'0000060003'
,'0000060004'
,'0000060010'
,'0000060020'
,'0000060030'
,'0000060040'
,'0000060100'
,'0000060110'
,'0000060200'
,'0000060210'
,'0000060220'
,'0000060225'
,'0000060230'
,'0000060235'
,'0000060240'
,'0000060250'
,'0000060260'
,'0000060270'
,'0000060280'
,'0000060290'
,'0000060295'
,'0000060300'
,'0000060310'
,'0000060320'
,'0000060330'
,'0000060340'
,'0000060350'
,'0000060360'
,'0000060400'
,'0000060500'
,'0000060505'
,'0000060510'
,'0000060520'
,'0000060525'
,'0000060530'
,'0000060540'
,'0000060550'
,'0000060560'
,'0000060570'
,'0000060590'
,'0000060591'
,'0000060600'
,'0000060700'
,'0000060800'
,'0000060802'
,'0000060900'
,'0000060905'
,'0000060910'
,'0000060911'
,'0000060920'
,'0000060921'
,'0000060930'
,'0000060990'
,'0000061000'
,'0000061100'
,'0000061201'
,'0000061202'
,'0000061203'
,'0000061204'
,'0000061205'
,'0000061300'
,'0000061310'
,'0000061400'
,'0000061410'
,'0000061420'
,'0000061430'
,'0000061490'
,'0000061491'
,'0000067200'
,'0000067210'
,'0000067220'
,'0000067230'
,'0000067630'
,'0000068000'
,'0000068010'
,'0000068300'
,'0000068310'
,'0000069900'
) 
AND B.HKONT NOT IN (
'0000067400'
,'0000067500'
,'0000067510'
,'0000067515'
,'0000067620'
,'0000068100'
,'0000067100'
,'0000067110'
,'0000067190'
,'0000067290')
)B WHERE FLAG = 'X'
)B WHERE ROWNUMBER = 1
)
;

--WHERE BSEG.BELNR = '9030013992'
--Select * FROM BSEG2 WHERE BELNR = '9030013992'